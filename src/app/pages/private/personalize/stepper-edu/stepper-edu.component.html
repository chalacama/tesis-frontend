<ui-loading-bar [visible]="saving()" [mask]="{ type: 'dimmed' }">
</ui-loading-bar>

<div class="stepper-edu-container">

    <header class="stepper-edu-header">
        <h1>Datos educativos</h1>
        <p>
            Completa tu información académica para personalizar tu experiencia en DigiMentor.
        </p>
    </header>

    <!-- SKELETON -->
    <ng-container *ngIf="isLoading(); else eduFormTpl">
        <div class="edu-skeleton-card" *ngFor="let row of skeletonRows">
            <div class="skeleton-header skeleton-box"></div>

            <div class="skeleton-row">
                <div class="skeleton-box"></div>
                <div class="skeleton-box"></div>
            </div>
        </div>
    </ng-container>

    <!-- FORM REAL -->
    <ng-template #eduFormTpl>
        <form [formGroup]="eduForm" (ngSubmit)="onSubmitEdu()" class="edu-form">

            <!-- CARD SEDE -->
            <section class="edu-card">
                <div class="card-header">
                    <h2>Sede / unidad educativa</h2>
                    <p>Selecciona la sede principal donde estudias actualmente.</p>
                </div>

                <div class="sede-select-wrapper">
                    <div class="sede-pill-list">
                        <button type="button" class="sede-pill" *ngFor="let sede of sedeOptions" (click)="onSelectSede(sede)" [class.sede-selected]="isSedeSelected(sede.id)">
              <div class="sede-pill-logo" *ngIf="sede.logoUrl">
                <img [src]="sede.logoUrl" [alt]="sede.label" />
              </div>
              <div class="sede-pill-text">
                <span class="sede-pill-label">{{ sede.label }}</span>
                <small class="sede-pill-subtitle">{{ sede.subtitle }}</small>
              </div>
            </button>
                    </div>

                    <div class="field-error" *ngIf="fieldInvalid('sede_id')">
                        Selecciona una sede para continuar.
                    </div>
                </div>

                <!-- Preview de sede seleccionada -->
                <div class="sede-preview" *ngIf="selectedSedeLogo || selectedSedeSubtitle">
                    <div class="sede-preview-logo" *ngIf="selectedSedeLogo">
                        <img [src]="selectedSedeLogo" alt="Logo sede seleccionada" />
                    </div>
                    <div class="sede-preview-text">
                        <p class="sede-preview-title">Sede seleccionada</p>
                        <p class="sede-preview-subtitle">
                            {{ selectedSedeSubtitle }}
                        </p>
                    </div>
                </div>
            </section>

            <!-- CARD PROGRAMA -->
            <section class="edu-card">
                <div class="card-header">
                    <h2>Programa y nivel académico</h2>
                    <p>Indica tu carrera, nivel educativo y tu periodo o semestre actual.</p>
                </div>

                <div class="edu-grid">
                    <!-- Carrera -->
                    <div class="field">
                        <label for="career_id">Carrera / programa</label>
                        <select id="career_id" formControlName="career_id" [class.invalid]="fieldInvalid('career_id')">
              <option value="" disabled [selected]="!eduForm.value.career_id">
                Selecciona una carrera
              </option>
              <option
                *ngFor="let career of filteredCareers"
                [value]="career.id">
                {{ career.name }}
              </option>
            </select>
                        <div class="field-error" *ngIf="fieldInvalid('career_id')">
                            Selecciona una carrera asociada a la sede.
                        </div>
                    </div>

                    <!-- Nivel educativo -->
                    <div class="field">
                        <label for="educational_level_id">Nivel educativo</label>
                        <select id="educational_level_id" formControlName="educational_level_id" [class.invalid]="fieldInvalid('educational_level_id')">
              <option value="" disabled [selected]="!eduForm.value.educational_level_id">
                Selecciona el nivel
              </option>
              <option *ngFor="let lvl of educationalLevels" [value]="lvl.id">
                {{ lvl.name }} ({{ lvl.period }})
              </option>
            </select>
                        <div class="field-error" *ngIf="fieldInvalid('educational_level_id')">
                            Selecciona tu nivel educativo actual.
                        </div>
                    </div>

                    <!-- Periodo / semestre -->
                    <div class="field">
                        <label for="level">Periodo / semestre actual</label>
                        <select id="level" formControlName="level" [class.invalid]="fieldInvalid('level')">
              <option value="" disabled [selected]="!eduForm.value.level">
                Selecciona tu periodo actual
              </option>
              <option *ngFor="let n of levelOptions" [value]="n">
                {{ n }}{{ getPeriodSuffix(n) }}
              </option>
            </select>
                        <div class="field-error" *ngIf="fieldInvalid('level')">
                            Indica tu periodo o semestre actual.
                        </div>
                    </div>
                </div>
            </section>

            <!-- ACCIONES -->
            <div class="edu-actions">
                <button type="submit" class="btn-primary" [disabled]="saving() || eduForm.invalid">
          Guardar y continuar
        </button>
            </div>
        </form>
    </ng-template>
</div>