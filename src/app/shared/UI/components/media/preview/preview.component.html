<!-- preview.component.html -->
<div
  [ngClass]="[
    'up-root',
    'v-' + (pv.variant || 'filled'),
    's-' + (pv.size || 'md'),
    pv.disabled ? 'is-disabled' : '',
    pv.previewClass || ''
  ]"
  [ngStyle]="styleMap()"
  [attr.role]="'button'"
  [attr.tabindex]="pv.disabled ? -1 : 0"
  [attr.aria-disabled]="pv.disabled"
  class="up-root"
>
  <!-- Marco de miniatura (solo image por ahora) -->
  <div class="up-frame" (click)="pv.overlay ? openDialog() : null">
    <img
      [ngStyle]="styleMap()"
      *ngIf="pv.types === 'image' && pv.src; else upEmpty"
      class="up-thumb"
      [src]="pv.src!"
      [alt]="pv.alt || 'Vista previa'"
      (click)="pv.overlay ? tryOpenFromOverlayClick($event) : stopPropagation($event)"
    />

    <ng-template #upEmpty>
      <div [ngStyle]="styleMap()" class="up-empty">Sin archivo</div>
    </ng-template>

    <!-- Overlay propio del Preview (controlado por pv.mask) -->
    <div [ngStyle]="styleMap()" class="up-overlay" *ngIf="pv.mask && pv.src">
      <ui-icon
        *ngIf="pv.overlay"
        [size]="pv.icon?.size || 'sm'"
        [severity]="pv.icon?.severity || pv.severity || 'primary'"
        [svgPath]="pv.icon?.svgPath || 'svg/eye.svg'"
        [iconStyle]="pv.icon?.iconStyle"
        [iconClass]="pv.icon?.iconClass">
      </ui-icon>

      <!-- Botones extra en overlay; NO abren el diálogo -->
      <div class="up-overlay-slot" (click)="stopPropagation($event)">
        <ng-content></ng-content>
      </div>
    </div>
  </div>

  <!-- Diálogo reutilizable (solo image por ahora) -->
  <ui-dialog
    *ngIf="pv.types === 'image'"
    type="image"
    [variant]="pv.variant || 'flat'"
    [maskType]="pv.masking?.maskType || 'blur'"
    [closeOnMaskClick]="pv.dialog?.closeOnMaskClick ?? true"
    [mask]="pv.dialog?.mask ?? true"
    [(visible)]="dialogVisible"
    (maskClick)="onMaskClick()"
  >
    <!-- Contenido del diálogo -->
    <img class="up-dialog-img" [src]="pv.src!" [alt]="pv.alt || 'Vista ampliada'">
  </ui-dialog>
</div>
